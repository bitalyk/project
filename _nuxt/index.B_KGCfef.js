import{_ as Q}from"./Hamster.vue.BGSh5QqN.js";import{_ as Z}from"./Preloader.vue.CEJmd39k.js";import{d as O,h as K,r as $,$ as H,o as u,a as m,b as a,f as e,y as N,a1 as ee,ah as B,ai as F,a2 as se,p as ae,q as P,a4 as te,m as ne,a0 as k,c as re,t as oe,g as p,aa as w,n as C,F as I,G as V,w as U,e as le,a9 as ie,X as G,u as D}from"./entry.PKrA3y6R.js";import{_ as ce}from"./image.vue.CMTZJcqa.js";import{_ as ue}from"./Price.vue.CIqOZq5A.js";import{N as de,E as me,a as _e,S as ge}from"./effect-fade.C-sU7EDq.js";const ve={class:"user-avatar"},pe=["srcset"],fe=["src"],he=O({__name:"AvatarImage",props:{image:{},compressed:{}},setup(_){const f=_;K();const t=$(f.image),r=$(f.compressed??"");t.value||(t.value=H);function h(){t.value=H}return(c,l)=>(u(),m("div",ve,[a("picture",null,[e(r)?(u(),m("source",{key:0,srcset:e(r),type:"image/webp"},null,8,pe)):N("",!0),a("img",{src:e(t),onError:l[0]||(l[0]=y=>h())},null,40,fe)])]))}}),ye=ee("league",{state:()=>({rating:[],tab:B.MINERS,period:F.DAY,currentLevel:0}),actions:{async postGetUsers(_){return await se.post("/clicker/rank",{body:{level:_}}).then(f=>{const{level:t,myRank:r,topUsers:h}=f;if(this.rating.find(l=>l.level===t)){const l=this.rating.findIndex(g=>g.level===t),y={level:t,myRank:r??null,topUsers:h??[]};this.rating[l]=y}else{const l={level:t,myRank:r??null,topUsers:h??[]};this.rating.push(l)}return f}).catch(f=>{ae.error({title:P().$i18n.t("messages.request_error"),message:P().$i18n.t("messages.no_rank")})})},setTab(_=B.MINERS){this.tab=_},setPeriod(_=F.DAY){this.period=_},setCurrentLevel(_=1){this.currentLevel=_}},getters:{}}),Le={class:"main"},ke={class:"inner league"},$e={class:"league-item"},Se={class:"league-item-image"},Ue={class:"league-data"},be={class:"league-data-name"},Ce={class:"league-numbers"},Ne=["innerHTML"],Ae={class:"league-progress-outer"},Ee={key:0,class:"league-progress"},Ie={key:0,class:"league-users-progress"},xe={class:"league-user-avatar"},Te={class:"league-user-info"},Me={class:"league-user-info-top"},Re={class:"league-user-position"},He=["innerHTML"],Be={class:"league-user is-my",key:"myUser"},Fe={class:"league-user-avatar"},Pe={class:"league-user-info"},we={class:"league-user-info-top"},Ve={class:"league-user-position"},qe=O({__name:"index",setup(_){const f=[de,me],t=$(null),r=ye(),h=te(),c=ne(),l=K(),y=$([]),g=$(""),A=$(!1),X=Object.values(k).filter(s=>!isNaN(s)),b=$(""),j=s=>g.value?g.value.includes("+")?!1:parseInt(g.value)===s:!1,q=re(()=>!!g.value&&g.value.includes("+")),z=()=>{var n;const s=(n=t.value)==null?void 0:n.slides;if(s){const d=s.find(i=>i.classList.contains("swiper-slide-fully-visible"));let v=null;if(d){const i=d.classList;for(let L=0;L<i.length;L++){const S=i[L];if(S.startsWith("is-")){v=S;break}}}if(b.value=v??"",v){const i=v.replace("is-","");T(i)!==r.currentLevel&&(r.setCurrentLevel(T(i)),x())}}},W=s=>{var n,d;t.value=s,b.value=`is-${E(k,((n=t==null?void 0:t.value)==null?void 0:n.activeIndex)+1)}`,r.setCurrentLevel(((d=t==null?void 0:t.value)==null?void 0:d.activeIndex)+1),x()},Y=s=>s>=c.getMaxUserLevel?`${D().t("friends.from")} ${l.numberFormat(c.getCoinsToLevelUpByLevel(s-1))}+`:c.level===s?`${l.numberFormat(c.balanceCoins??0)} / ${l.numberFormat(c.getCoinsToLevelUpByLevel(s)??0)}`:`${D().t("friends.from")} ${l.numberFormat(c.getCoinsToLevelUpByLevel(s-1))}`,x=async()=>{const s=r.rating.find(n=>n.level===r.currentLevel);s?(y.value=s.topUsers,g.value=s.myRank??""):(A.value=!0,await r.postGetUsers(r.currentLevel).then(n=>{y.value=n.topUsers,g.value=n.myRank??""}).finally(()=>{A.value=!1}))};function E(s,n){return Object.keys(s).find(d=>s[d]===n)}function T(s){const n=Object.keys(k).filter(i=>typeof k[i]=="number"),d=n.map(i=>k[i]),v=n.indexOf(s);if(v!==-1)return d[v]}return oe(()=>{r.rating=[]}),(s,n)=>{var M,R;const d=Q,v=Z,i=he,L=ce,S=ue;return u(),m("main",Le,[a("div",ke,[p(e(ge),{class:C(["league-slider",e(b)]),loop:!1,effect:"fade",onSwiper:W,navigation:"",modules:f,onSlideChange:z,initialSlide:e(c).level-1},{default:w(()=>[(u(!0),m(I,null,V(e(X),o=>(u(),le(e(_e),{class:C(["league-slide",`is-${E(e(k),o)}`]),key:o},{default:w(()=>[a("div",$e,[a("div",Se,[p(d,{level:o},null,8,["level"])])]),a("div",Ue,[a("div",be,U(E(e(k),o)),1)]),a("div",Ce,[a("span",{innerHTML:Y(o)},null,8,Ne)]),a("div",Ae,[e(c).level===o?(u(),m("div",Ee,[a("div",{class:"league-progress-bar",style:ie({width:`${e(c).getProgressLevel}%`})},null,4)])):N("",!0)])]),_:2},1032,["class"]))),128))]),_:1},8,["initialSlide","class"]),a("div",{class:C(["league-users",e(b)])},[e(A)?(u(),m("div",Ie,[p(v)])):(u(),m(I,{key:1},[e(y).length>0?(u(!0),m(I,{key:0},V(e(y),(o,J)=>(u(),m("div",{class:C(["league-user",{"is-my":j(o.rank)}]),key:`l${e(r).currentLevel}-${J}`},[a("div",xe,[p(i,{image:o.avatarUrl??""},null,8,["image"])]),a("div",Te,[a("div",Me,[p(L,{name:o.exchangeId??e(G).DEFAULT_EXCHANGE},null,8,["name"]),a("p",null,U(e(l).composeUsername(o.firstName,o.lastName,o.username)),1)]),p(S,{price:o.earnPassivePerHour,round:!1},null,8,["price"])]),a("div",Re,U(o.rank),1)],2))),128)):e(y).length?N("",!0):(u(),m("p",{key:1,innerHTML:s.$t("league.no_users")},null,8,He)),e(q)?(u(),m("div",Be,[a("div",Fe,[p(i,{image:(M=e(h).account_avatar)==null?void 0:M.defaultUrl,compressed:(R=e(h).account_avatar)==null?void 0:R.compressedUrl},null,8,["image","compressed"])]),a("div",Pe,[a("div",we,[p(L,{name:e(c).exchangeId??e(G).DEFAULT_EXCHANGE},null,8,["name"]),a("p",null,U(e(h).account_name),1)]),p(S,{price:e(c).earnPassivePerHour??0,round:!1},null,8,["price"])]),a("div",Ve,U(e(g)),1)])):N("",!0)],64))],2)])])}}});export{qe as default};
